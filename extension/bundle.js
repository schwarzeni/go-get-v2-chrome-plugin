!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BilibiliID="0",t.BilibiliPluginId="1",t.YoukuId="2",t.IqiyiId="3",t.TencentId="4",t.DefaultsavePathId="1000",t.DefaultSavePath="~/Downloads/",t.MenuId="mainMenu",t.InfoBili={api:"playurl?cid=",Id:t.BilibiliID},t.InfoBiliPlugin={api:".php?cid=",Id:t.BilibiliPluginId},t.InfoYoukuPlugin={api:"m3u8?vid=",Id:t.YoukuId},t.InfoIqiyi={api:"dash?tvid",Id:t.IqiyiId},t.InfoTencent={api:"m3u8?ver",Id:t.TencentId},t.WebsiteInfoArray=[t.InfoBili,t.InfoBiliPlugin,t.InfoYoukuPlugin,t.InfoIqiyi,t.InfoTencent]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetMessageEvent=0,t.SendMessageEvent=1,t.DeleteVideoEvent=2,t.UpdateVideoPathEvent=3,t.UpdateVideoApiEvent=4,t.GetVideoInfoByKey=5,t.ClearAllDataEvent=6},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.map=new Map}Set(e,t){this.map.set(e,t)}SetApi(e,t){let n=this.map.get(e);n?n.apiUrl=t.apiUrl:n=t,this.map.set(e,n)}SetPath(e,t){let n=this.map.get(e);n?n.savePath=t.savePath:n=t,this.map.set(e,n)}Has(e){return this.map.has(e)}Get(e){return this.map.get(e)}GetArray(){let e=[];return 0===this.map.size?[]:(this.map.forEach((t,n,r)=>{e.push(t)}),e)}Delete(e){this.map.delete(e)}ClearAll(){this.map.clear()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.SetMapData=function(e,t,n,i,o){let a=localStorage.getItem(r.DefaultsavePathId);if(null!==a&&""!==a){let e=o;e=e.trim().replace(new RegExp(" ","g"),"_").replace(new RegExp(String.fromCharCode(160),"g"),"_"),a.endsWith("/")?a+=e:a=a+"/"+e}else a="";(e.Has(t.referer)&&e.Get(t.referer).webId===n.Id||!e.Has(t.referer))&&e.SetApi(t.referer,{apiUrl:i,webId:n.Id,cookie:t.cookie,savePath:a,webpageUrl:t.referer,title:o})},t.GetReferAndCookie=function(e){let t={referer:"",cookie:""};for(let n=0;n<e.length;n++)"Referer"===e[n].name&&(t.referer=e[n].value),"Cookie"===e[n].name&&(t.cookie=e[n].value);return t},t.SelectWebInfoByUrl=function(e){for(let t=0;t<r.WebsiteInfoArray.length;t++)if(-1!==e.indexOf(r.WebsiteInfoArray[t].api))return r.WebsiteInfoArray[t];return null},t.GetTitle=function(e){let t=new XMLHttpRequest;t.open("GET",e,!1),t.send();let n=t.responseText,r=/<title[\w\s="'-]*>(.*)<\/title>/g.exec(n);return r&&r[1]?r[1]:""}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(3),o=n(2),a=n(1);let l=new o.default;chrome.webRequest.onSendHeaders.addListener(function(e){let t=i.GetReferAndCookie(e.requestHeaders),n=i.SelectWebInfoByUrl(e.url);return null!==n&&i.SetMapData(l,t,n,e.url,i.GetTitle(t.referer)),e},{urls:["<all_urls>"]},["requestHeaders"]),chrome.contextMenus.create({title:"Get current page video info",id:r.MenuId,onclick:function(){}},function(){}),chrome.contextMenus.onClicked.addListener(function(e){e.menuItemId===r.MenuId&&chrome.tabs.query({active:!0,lastFocusedWindow:!0},function(e){var t=e[0].url;l.Has(t)&&chrome.tabs.executeScript({code:`var videoData = ${JSON.stringify(l.Get(t))}`},function(){chrome.tabs.executeScript(e[0].id,{file:"lib/jquery.min.js"}),chrome.tabs.executeScript(e[0].id,{file:"lib/bootstrap.min.js"}),chrome.tabs.executeScript(e[0].id,{file:"pop.js"})})})}),chrome.runtime.onMessage.addListener(function(e,t,n){chrome.runtime.id===t.id&&l.Has(e.webpageUrl)&&l.Set(e.webpageUrl,e)}),chrome.runtime.onMessage.addListener(function(e,t,n){e===a.GetMessageEvent&&n({DataMap:l.GetArray()})}),chrome.runtime.onMessage.addListener(function(e,t,n){if(e.Msg===a.GetVideoInfoByKey){n(l.Get(e.Key))}}),chrome.runtime.onMessage.addListener(function(e,t,n){e.Msg===a.DeleteVideoEvent&&l.Delete(e.WebPageUrl)}),chrome.runtime.onMessage.addListener(function(e,t,n){e.Msg===a.UpdateVideoPathEvent&&l.SetPath(e.VideoInfo.webpageUrl,e.VideoInfo)}),chrome.runtime.onMessage.addListener(function(e,t,n){e.Msg===a.ClearAllDataEvent&&l.ClearAll()})}]);
//# sourceMappingURL=bundle.js.map