{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/extension/config.ts","webpack:///./src/global-data.ts","webpack:///./src/extension/dataMap.ts","webpack:///./src/extension/util.ts","webpack:///./src/extension/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","BilibiliID","BilibiliPluginId","YoukuId","IqiyiId","TencentId","DefaultsavePathId","DefaultSavePath","MenuId","InfoBili","api","Id","InfoBiliPlugin","InfoYoukuPlugin","InfoIqiyi","InfoTencent","WebsiteInfoArray","GetMessageEvent","SendMessageEvent","DeleteVideoEvent","UpdateVideoPathEvent","UpdateVideoApiEvent","GetVideoInfoByKey","ClearAllDataEvent","default","[object Object]","this","map","Map","refer","video","set","apiUrl","savePath","has","arr","size","forEach","val","push","delete","clear","config_1","SetMapData","datamap","headerInfo","infoVideo","url","title","savepath","localStorage","getItem","savepathtitle","trim","replace","RegExp","String","fromCharCode","endsWith","Has","referer","Get","webId","SetApi","cookie","webpageUrl","GetReferAndCookie","requestHeaders","data","length","SelectWebInfoByUrl","indexOf","GetTitle","xhr","XMLHttpRequest","open","send","result","responseText","matchStr","exec","util_1","dataMap_1","global_data_1","chrome","webRequest","onSendHeaders","addListener","detail","urls","contextMenus","id","onclick","onClicked","tab","menuItemId","tabs","query","active","lastFocusedWindow","executeScript","code","JSON","stringify","file","runtime","onMessage","message","sender","callBack","Set","DataMap","GetArray","Msg","Key","Delete","WebPageUrl","SetPath","VideoInfo","callback","ClearAll"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","import {VideoInfo, WebsiteInfo} from './interfaces';\n\nexport const BilibiliID = '0';\nexport const BilibiliPluginId = '1';\nexport const YoukuId = '2';\nexport const IqiyiId = '3';\nexport const TencentId = '4';\n\nexport const DefaultsavePathId = '1000';\n\n/**\n * 默认存储路径\n */\nexport const DefaultSavePath = '~/Downloads/';\n\n\n/**\n * 右击菜单的ID\n * @type {string}\n */\nexport const MenuId = \"mainMenu\";\n\n/**\n * b站信息\n */\nexport const InfoBili: WebsiteInfo = {api: 'playurl?cid=', Id: BilibiliID};\n\n/**\n * b站插件信息\n */\nexport const InfoBiliPlugin: WebsiteInfo = {api: '.php?cid=', Id: BilibiliPluginId};\n\n/**\n *  优酷信息\n */\nexport const InfoYoukuPlugin: WebsiteInfo = {api: 'm3u8?vid=', Id: YoukuId};\n\n/**\n * 爱奇艺信息\n */\nexport const InfoIqiyi: WebsiteInfo = {api: 'dash?tvid', Id: IqiyiId}\n\n/**\n * 腾讯信息\n */\nexport const InfoTencent: WebsiteInfo = {api: 'm3u8?ver', Id: TencentId}\n\nexport const WebsiteInfoArray: WebsiteInfo[] = [InfoBili, InfoBiliPlugin, InfoYoukuPlugin, InfoIqiyi, InfoTencent];\n","import DataMap from './extension/dataMap';\nimport {VideoInfo} from './extension/interfaces';\n\nexport const GetMessageEvent = 0;\n\nexport const SendMessageEvent = 1;\n\nexport const DeleteVideoEvent = 2;\n\nexport const UpdateVideoPathEvent = 3;\n\nexport const UpdateVideoApiEvent = 4\n\nexport const GetVideoInfoByKey = 5;\n\nexport const ClearAllDataEvent = 6;\n\nexport interface ClearAllDataMessage {\n  Msg: number\n}\n\nexport interface GetVideoInfoByKeyMessage {\n  Msg: number,\n  Key: string\n}\n\nexport interface UpdateVideoApiMessage {\n  Msg: number\n  VideoInfo: VideoInfo\n}\n\nexport interface UpdateVideoPathMessage {\n  Msg: number\n  VideoInfo: VideoInfo\n}\n\nexport interface DeleteVideoMessage {\n  Msg: number\n  WebPageUrl: string\n}\n\nexport interface ResponseDataMap {\n  DataMap: Array<VideoInfo>\n}","import {VideoInfo} from './interfaces';\nexport default class DataMap {\n  map: Map<string, VideoInfo>;\n  constructor() {\n    this.map = new Map<string, VideoInfo>()\n  }\n  Set(refer: string, video: VideoInfo) {\n    this.map.set(refer, video)\n  }\n  SetApi(refer: string, video: VideoInfo) {\n    let m = this.map.get(refer);\n    if (m) {\n      m.apiUrl = video.apiUrl;\n    } else {\n      m = video\n    }\n    this.map.set(refer, m)\n  }\n  SetPath(refer: string, video: VideoInfo) {\n    let m = this.map.get(refer)\n    if (m) {\n      m.savePath = video.savePath\n    } else {\n      m = video\n    }\n    this.map.set(refer, m)\n  }\n  Has(refer: string): boolean {\n    return this.map.has(refer)\n  }\n  Get(refer: string): VideoInfo {\n    return this.map.get(refer)\n  }\n  GetArray(): Array<VideoInfo> {\n    let arr : Array<VideoInfo>= [];\n    if (this.map.size === 0) {\n      return []\n    }\n    this.map.forEach((val, key, m) => {\n      arr.push(val)\n    });\n    return arr;\n  }\n  Delete(key: string) {\n    this.map.delete(key);\n  }\n  ClearAll() {\n    this.map.clear()\n  }\n}","/**\n * 设置map的值\n * @param {Map<string, VideoInfo>} dataMap\n * @param {ReferAndCookie} headerInfo\n * @param infoVideo\n */\nimport DataMap from './dataMap';\nimport {ReferAndCookie, VideoInfo, WebsiteInfo} from './interfaces';\nimport {DefaultSavePath, DefaultsavePathId, WebsiteInfoArray} from './config';\nimport HttpHeader = chrome.webRequest.HttpHeader;\n\nexport function SetMapData(datamap: DataMap, headerInfo: ReferAndCookie, infoVideo: WebsiteInfo, url: string, title: string) {\n  // 设置savepath\n  let savepath = localStorage.getItem(DefaultsavePathId);\n  if (savepath !== null && savepath !== \"\") {\n    let savepathtitle = title;\n    savepathtitle = savepathtitle\n      .trim()\n      .replace(new RegExp(\" \", \"g\"), \"_\")\n      .replace(new RegExp(String.fromCharCode(160), \"g\"), \"_\");\n    if (savepath.endsWith(\"/\")) {\n      savepath = savepath + savepathtitle\n    } else {\n      savepath = savepath + \"/\" + savepathtitle\n    }\n  } else {\n    savepath = \"\"\n  }\n  if ((datamap.Has(headerInfo.referer) && datamap.Get(headerInfo.referer).webId === infoVideo.Id) || !datamap.Has(headerInfo.referer)) {\n    datamap.SetApi(headerInfo.referer, {apiUrl: url, webId: infoVideo.Id, cookie: headerInfo.cookie, savePath: savepath, webpageUrl: headerInfo.referer, title: title})\n  }\n}\n\n\n/**\n * 获取header中的refer值和cookie值\n * @param {Array} requestHeaders Header信息\n * @returns {ReferAndCookie} refer与cookie信息\n */\nexport function GetReferAndCookie(requestHeaders: Array<HttpHeader>): ReferAndCookie {\n  let data: ReferAndCookie = {referer: \"\", cookie: \"\"};\n  for (let i = 0; i < requestHeaders.length; i++) {\n    if (requestHeaders[i].name === 'Referer') {\n      data.referer = requestHeaders[i].value\n    }\n    if(requestHeaders[i].name === 'Cookie') {\n      data.cookie = requestHeaders[i].value\n    }\n  }\n  return data\n}\n\n// 根据api的类型判断网站\n// TODO：可以根据refer来进行判断\nexport function SelectWebInfoByUrl(url: string) : WebsiteInfo {\n  for (let i = 0; i < WebsiteInfoArray.length; i++) {\n    if (url.indexOf(WebsiteInfoArray[i].api) !== -1) {\n      return WebsiteInfoArray[i]\n    }\n  }\n  return null\n}\n\n// 获取页面的标题\nexport function GetTitle(url: string): string {\n  let xhr: XMLHttpRequest = new XMLHttpRequest();\n  xhr.open(\"GET\", url, false);\n  xhr.send();\n\n  let result = xhr.responseText;\n  let matchStr = /<title[\\w\\s=\"'-]*>(.*)<\\/title>/g.exec(result)\n  if (matchStr && matchStr[1]) {\n    return matchStr[1]\n  } else {\n    return \"\"\n  }\n}","/**\n * 默认保存路径\n */\nimport { MenuId} from './config';\nimport {GetReferAndCookie, GetTitle, SelectWebInfoByUrl, SetMapData} from './util';\nimport DataMap from './dataMap'\nimport {ReferAndCookie, VideoInfo, WebsiteInfo} from './interfaces';\nimport MessageSender = chrome.runtime.MessageSender;\nimport {\n  ClearAllDataEvent,\n  ClearAllDataMessage,\n  DeleteVideoEvent, DeleteVideoMessage, GetMessageEvent, GetVideoInfoByKey, GetVideoInfoByKeyMessage, ResponseDataMap,\n  UpdateVideoPathEvent, UpdateVideoPathMessage,\n} from '../global-data';\n\nlet datamap = new DataMap()\n\n\n\nchrome.webRequest.onSendHeaders.addListener(function(detail) {\n  let headerInfo: ReferAndCookie = GetReferAndCookie(detail.requestHeaders);\n  let result: WebsiteInfo = SelectWebInfoByUrl(detail.url);\n  if (result !== null) {\n    SetMapData(datamap, headerInfo, result, detail.url, GetTitle(headerInfo.referer))\n  }\n  return detail\n}, {urls: [ \"<all_urls>\" ]}, ['requestHeaders'])\n\n// 创建一个chrome的meun\nchrome.contextMenus.create({title: \"Get current page video info\", id: MenuId, onclick: function(){}}, function(){\n})\n// 添加一个chrome的menu选项，点击获取链接\nchrome.contextMenus.onClicked.addListener(function(tab) {\n  if (tab.menuItemId === MenuId) {\n    chrome.tabs.query({'active': true, 'lastFocusedWindow': true}, function (tabs) {\n      var url = tabs[0].url;\n      if (datamap.Has(url)) {\n        chrome.tabs.executeScript( {\n          code: `var videoData = ${JSON.stringify(datamap.Get(url))}`\n        }, function(){\n          chrome.tabs.executeScript(tabs[0].id,{file: 'lib/jquery.min.js'})\n          chrome.tabs.executeScript(tabs[0].id,{file: 'lib/bootstrap.min.js'})\n          chrome.tabs.executeScript(tabs[0].id, {file: 'pop.js'});\n        })\n      }\n    });\n  }\n});\n\n// 更新video的信息(接收用户的保存路径)\nchrome.runtime.onMessage.addListener(function(message: VideoInfo, sender: MessageSender, callBack: Function) {\n  if (chrome.runtime.id === sender.id) {\n    if (datamap.Has(message.webpageUrl)) {\n      datamap.Set(message.webpageUrl, message)\n    }\n  }\n});\n\n// 接收options页获取已经抓取的视频链接的请求\nchrome.runtime.onMessage.addListener(function(message: number, sender: MessageSender, callBack: Function) {\n  if (message === GetMessageEvent) {\n    callBack({DataMap: datamap.GetArray()})\n  }\n});\n\n// 接收获取单个videoInfo的请求\nchrome.runtime.onMessage.addListener(function(message: GetVideoInfoByKeyMessage, sender: MessageSender, callBack: Function) {\n  if (message.Msg === GetVideoInfoByKey) {\n    let videoInfo = datamap.Get(message.Key)\n    callBack(videoInfo)\n  }\n});\n\n// 接收options页的模态框中删除信息请求\nchrome.runtime.onMessage.addListener(function(message: DeleteVideoMessage, sender: MessageSender, callBack: Function) {\n  if (message.Msg === DeleteVideoEvent) {\n    datamap.Delete(message.WebPageUrl)\n  }\n});\n\n// 接收options页的模态框中修改路径信息请求\nchrome.runtime.onMessage.addListener(function(message: UpdateVideoPathMessage, sender: MessageSender, callBack: Function) {\n  if (message.Msg === UpdateVideoPathEvent) {\n    datamap.SetPath(message.VideoInfo.webpageUrl, message.VideoInfo)\n  }\n});\n\n// 接收options页清空数据的请求\nchrome.runtime.onMessage.addListener(function (message: ClearAllDataMessage, sender: MessageSender, callback: Function) {\n  if (message.Msg === ClearAllDataEvent) {\n    datamap.ClearAll()\n  }\n})\n"],"sourceRoot":""}